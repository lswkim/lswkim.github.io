---
title: "[FastAPI ì›¹ì„œë²„ì¸í„°í˜ì´ìŠ¤ 1] WSGI ë™ì‘ ì›ë¦¬"
date: 2025-12-28 16:00:00 +0900
categories: [Tech, FastAPI]
tags: [python, wsgi, web-server, gunicorn, flask, django]
mermaid: true
---

> **ğŸ“š FastAPI ì‹œë¦¬ì¦ˆ - Part 3. ì›¹ ì„œë²„ ì¸í„°í˜ì´ìŠ¤**
>
> 1. WSGI ë™ì‘ ì›ë¦¬ â† í˜„ì¬ ê¸€
> 2. [ASGI ë™ì‘ ì›ë¦¬](/posts/asgi/)
> 3. [Uvicorn ë‚´ë¶€ êµ¬ì¡°](/posts/uvicorn-internals/)
> 4. [Gunicorn + Uvicorn ì¡°í•© ìƒì„¸](/posts/gunicorn-uvicorn/)

---

# 1. WSGI ë™ì‘ ì›ë¦¬

## ì™œ ì´ ê°œë…ì´ ì¤‘ìš”í•œê°€?

- WSGIëŠ” ì „í†µì ì¸ Python ì›¹ì˜ í‘œì¤€
- ASGI(FastAPIê°€ ì‚¬ìš©)ë¥¼ ì´í•´í•˜ë ¤ë©´ WSGIë¥¼ ë¨¼ì € ì•Œì•„ì•¼ í•¨
- Django, Flask ë“± ëŒ€ë¶€ë¶„ì˜ Python ì›¹ í”„ë ˆì„ì›Œí¬ê°€ WSGI ê¸°ë°˜

---

## WSGIë€?

### í•œ ì¤„ ì •ì˜

**Web Server Gateway Interface - ì›¹ ì„œë²„ì™€ Python ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ì´ì˜ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**

### ë°°ê²½: WSGI ì´ì „ì˜ ë¬¸ì œ

```mermaid
graph LR
    subgraph Before["WSGI ì´ì „"]
        A1["Apache + mod_python"] --> D1["Django<br/>(Apache ì „ìš© ì½”ë“œ)"]
        A2["Nginx + FastCGI"] --> D2["Django<br/>(Nginx ì „ìš© ì½”ë“œ)"]
        A3["ë‹¤ë¥¸ ì„œë²„"] --> D3["Django<br/>(ë˜ ë‹¤ë¥¸ ì½”ë“œ)"]
    end
    Note["â†’ ì„œë²„ì™€ í”„ë ˆì„ì›Œí¬ê°€ ê°•í•˜ê²Œ ê²°í•©<br/>â†’ ì„œë²„ ë°”ê¾¸ë©´ ì½”ë“œ ìˆ˜ì • í•„ìš”"]
```

### WSGIì˜ í•´ê²°

```mermaid
graph LR
    subgraph Servers["ì›¹ ì„œë²„"]
        S1["Gunicorn"]
        S2["uWSGI"]
        S3["mod_wsgi"]
    end

    subgraph WSGI["WSGI"]
        W["í‘œì¤€ ì¸í„°í˜ì´ìŠ¤"]
    end

    subgraph Apps["ì• í”Œë¦¬ì¼€ì´ì…˜"]
        A1["Django"]
        A2["Flask"]
        A3["Pyramid"]
    end

    S1 --> W
    S2 --> W
    S3 --> W
    W --> A1
    W --> A2
    W --> A3
```

â†’ ì„œë²„ì™€ í”„ë ˆì„ì›Œí¬ê°€ ë…ë¦½ì , ì•„ë¬´ ì„œë²„ + ì•„ë¬´ í”„ë ˆì„ì›Œí¬ ì¡°í•© ê°€ëŠ¥

---

## WSGI ì¸í„°í˜ì´ìŠ¤

### ê°€ì¥ ê°„ë‹¨í•œ WSGI ì• í”Œë¦¬ì¼€ì´ì…˜

```python
def application(environ, start_response):
    """
    environ: ìš”ì²­ ì •ë³´ê°€ ë‹´ê¸´ ë”•ì…”ë„ˆë¦¬
    start_response: ì‘ë‹µ ì‹œì‘ì„ ì•Œë¦¬ëŠ” ì½œë°± í•¨ìˆ˜
    """
    # ì‘ë‹µ í—¤ë” ì„¤ì •
    status = '200 OK'
    headers = [('Content-Type', 'text/plain')]
    start_response(status, headers)

    # ì‘ë‹µ ë³¸ë¬¸ ë°˜í™˜ (iterable)
    return [b'Hello, World!']

```

### í•µì‹¬ ê·œì¹™

| í•­ëª© | ì„¤ëª… |
|:---:|:---|
| í˜¸ì¶œ ê°€ëŠ¥ ê°ì²´ | í•¨ìˆ˜, í´ë˜ìŠ¤, `__call__` ë©”ì„œë“œ |
| ì¸ì 2ê°œ | `environ`, `start_response` |
| ë°˜í™˜ê°’ | iterable (ë¦¬ìŠ¤íŠ¸, ì œë„ˆë ˆì´í„° ë“±) |
| ë™ê¸° ì‹¤í–‰ | ìš”ì²­ë‹¹ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ |

---

## environ ë”•ì…”ë„ˆë¦¬

### ì£¼ìš” í•­ëª©

```python
def application(environ, start_response):
    # HTTP ìš”ì²­ ì •ë³´
    method = environ['REQUEST_METHOD']      # GET, POST ë“±
    path = environ['PATH_INFO']             # /users/123
    query = environ['QUERY_STRING']         # name=kim&age=30

    # HTTP í—¤ë” (HTTP_ ì ‘ë‘ì‚¬)
    host = environ.get('HTTP_HOST')         # example.com
    user_agent = environ.get('HTTP_USER_AGENT')

    # ì„œë²„ ì •ë³´
    server_name = environ['SERVER_NAME']
    server_port = environ['SERVER_PORT']

    # ìš”ì²­ ë³¸ë¬¸
    content_length = environ.get('CONTENT_LENGTH', 0)
    request_body = environ['wsgi.input'].read(int(content_length))

    start_response('200 OK', [('Content-Type', 'text/plain')])
    return [f'Method: {method}, Path: {path}'.encode()]

```

### environ ì£¼ìš” í‚¤

| í‚¤ | ì„¤ëª… | ì˜ˆì‹œ |
|:---:|:---|:---|
| `REQUEST_METHOD` | HTTP ë©”ì„œë“œ | `GET`, `POST` |
| `PATH_INFO` | ìš”ì²­ ê²½ë¡œ | `/users/123` |
| `QUERY_STRING` | ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ | `name=kim` |
| `CONTENT_TYPE` | ë³¸ë¬¸ íƒ€ì… | `application/json` |
| `CONTENT_LENGTH` | ë³¸ë¬¸ ê¸¸ì´ | `42` |
| `HTTP_*` | HTTP í—¤ë”ë“¤ | `HTTP_HOST` |
| `wsgi.input` | ìš”ì²­ ë³¸ë¬¸ ìŠ¤íŠ¸ë¦¼ | file-like ê°ì²´ |

---

## ìš”ì²­ ì²˜ë¦¬ íë¦„

```mermaid
sequenceDiagram
    participant C as í´ë¼ì´ì–¸íŠ¸
    participant S as WSGI ì„œë²„ (Gunicorn)
    participant A as WSGI ì• í”Œë¦¬ì¼€ì´ì…˜ (Flask)

    C->>S: HTTP ìš”ì²­: GET /users
    Note over S: 1. HTTP ìš”ì²­ íŒŒì‹±<br/>2. environ ë”•ì…”ë„ˆë¦¬ ìƒì„±<br/>3. start_response ì½œë°± ì¤€ë¹„

    S->>A: application(environ, start_response)
    Note over A: 1. environì—ì„œ ìš”ì²­ ì •ë³´ ì¶”ì¶œ<br/>2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰<br/>3. start_response(status, headers)<br/>4. ì‘ë‹µ ë³¸ë¬¸ ë°˜í™˜

    A-->>S: [b'{"users": [...]}']
    Note over S: 1. HTTP ì‘ë‹µ ìƒì„±<br/>2. í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡

    S-->>C: HTTP ì‘ë‹µ: 200 OK
```

---

## Flaskê°€ WSGIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

### Flask ì•±ì˜ ì‹¤ì²´

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, World!'

# appì€ WSGI ì• í”Œë¦¬ì¼€ì´ì…˜!
# ë‚´ë¶€ì ìœ¼ë¡œ __call__ ë©”ì„œë“œê°€ ìˆìŒ

```

### Flask ë‚´ë¶€ (ë‹¨ìˆœí™”)

```python
class Flask:
    def __call__(self, environ, start_response):
        """Flask ì•±ì€ WSGI callable"""
        # environì—ì„œ ìš”ì²­ ì •ë³´ ì¶”ì¶œ
        request = self.create_request(environ)

        # ë¼ìš°íŒ… + ë·° í•¨ìˆ˜ ì‹¤í–‰
        response = self.dispatch_request(request)

        # WSGI ì‘ë‹µ ë°˜í™˜
        return response(environ, start_response)

```

---

## WSGI ì„œë²„ë“¤

### ì£¼ìš” WSGI ì„œë²„

| ì„œë²„ | íŠ¹ì§• | ì‚¬ìš© |
|:---:|:---|:---|
| **Gunicorn** | ê°€ì¥ ë„ë¦¬ ì‚¬ìš©, ê°„ë‹¨í•œ ì„¤ì • | í”„ë¡œë•ì…˜ |
| **uWSGI** | ê³ ì„±ëŠ¥, ë³µì¡í•œ ì„¤ì • | í”„ë¡œë•ì…˜ |
| **mod_wsgi** | Apache ëª¨ë“ˆ | Apache í™˜ê²½ |
| **Waitress** | Windows ì§€ì›, ìˆœìˆ˜ Python | ê°œë°œ/í”„ë¡œë•ì…˜ |
| **Werkzeug** | Flask ë‚´ì¥ ê°œë°œ ì„œë²„ | ê°œë°œìš© |

### Gunicorn ì‹¤í–‰ ì˜ˆì‹œ

```bash
# ê¸°ë³¸ ì‹¤í–‰
gunicorn app:application

# ì›Œì»¤ ìˆ˜ ì§€ì •
gunicorn -w 4 app:application

# ë°”ì¸ë“œ ì£¼ì†Œ ì§€ì •
gunicorn -b 0.0.0.0:8000 -w 4 app:application

```

---

## WSGIì˜ ë™ì‹œì„± ëª¨ë¸

### ë™ê¸° + ë©€í‹° í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ

```mermaid
graph TB
    subgraph Gunicorn["Gunicorn ë™ì‹œì„± ëª¨ë¸"]
        M["Master Process"]
        M --> W1["Worker 1<br/>ìš”ì²­ A ì²˜ë¦¬ ì¤‘ (ë¸”ë¡œí‚¹)"]
        M --> W2["Worker 2<br/>ìš”ì²­ B ì²˜ë¦¬ ì¤‘ (ë¸”ë¡œí‚¹)"]
        M --> W3["Worker 3<br/>ìš”ì²­ C ì²˜ë¦¬ ì¤‘ (ë¸”ë¡œí‚¹)"]
        M --> W4["Worker 4<br/>ëŒ€ê¸° ì¤‘"]
    end
    Note["ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥ ìš”ì²­ ìˆ˜ = ì›Œì»¤ ìˆ˜"]
```

### WSGIì˜ í•œê³„

| í•œê³„ | ì„¤ëª… |
|:---:|:---|
| **ë™ê¸° ì „ìš©** | async/await ì‚¬ìš© ë¶ˆê°€ |
| **ìš”ì²­ë‹¹ ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤** | ë¦¬ì†ŒìŠ¤ ì†Œë¹„ í¼ |
| **WebSocket ë¶ˆê°€** | ì¥ì‹œê°„ ì—°ê²° ìœ ì§€ ì–´ë ¤ì›€ |
| **HTTP/2 ë¯¸ì§€ì›** | HTTP/1.1ë§Œ ê°€ëŠ¥ |

---

## WSGI ë¯¸ë“¤ì›¨ì–´

### ê°œë…

```mermaid
graph LR
    subgraph Chain["WSGI ë¯¸ë“¤ì›¨ì–´ ì²´ì¸"]
        R["ìš”ì²­"] --> M1["ë¯¸ë“¤ì›¨ì–´ 1"] --> M2["ë¯¸ë“¤ì›¨ì–´ 2"] --> A["ì• í”Œë¦¬ì¼€ì´ì…˜"]
        A --> M2B["ë¯¸ë“¤ì›¨ì–´ 2"] --> M1B["ë¯¸ë“¤ì›¨ì–´ 1"] --> RS["ì‘ë‹µ"]
    end
```

### ì˜ˆì‹œ: ë¡œê¹… ë¯¸ë“¤ì›¨ì–´

```python
class LoggingMiddleware:
    def __init__(self, app):
        self.app = app

    def __call__(self, environ, start_response):
        # ìš”ì²­ ë¡œê¹…
        print(f"Request: {environ['REQUEST_METHOD']} {environ['PATH_INFO']}")

        # ì›ë˜ ì•± í˜¸ì¶œ
        response = self.app(environ, start_response)

        # ì‘ë‹µ ë¡œê¹…
        print("Response sent")

        return response

# ì ìš©
app = LoggingMiddleware(original_app)

```

---

## ê°„ë‹¨í•œ WSGI í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸°

### ì§ì ‘ êµ¬í˜„í•´ë³´ê¸° (êµìœ¡ìš©)

```python
class MiniFramework:
    def __init__(self):
        self.routes = {}

    def route(self, path):
        def decorator(func):
            self.routes[path] = func
            return func
        return decorator

    def __call__(self, environ, start_response):
        path = environ['PATH_INFO']

        if path in self.routes:
            # ë¼ìš°íŠ¸ ì°¾ìŒ
            handler = self.routes[path]
            body = handler()
            status = '200 OK'
        else:
            # 404
            body = 'Not Found'
            status = '404 Not Found'

        headers = [('Content-Type', 'text/plain')]
        start_response(status, headers)
        return [body.encode()]

# ì‚¬ìš©
app = MiniFramework()

@app.route('/')
def home():
    return 'Hello, Home!'

@app.route('/about')
def about():
    return 'About Page'

# Gunicornìœ¼ë¡œ ì‹¤í–‰: gunicorn myapp:app

```

---

## WSGI vs CGI

| í•­ëª© | CGI | WSGI |
|:---:|:---|:---|
| í”„ë¡œì„¸ìŠ¤ | ìš”ì²­ë§ˆë‹¤ ìƒˆ í”„ë¡œì„¸ìŠ¤ | í”„ë¡œì„¸ìŠ¤ ì¬ì‚¬ìš© |
| ì„±ëŠ¥ | ëŠë¦¼ | ë¹ ë¦„ |
| ë©”ëª¨ë¦¬ | ë¹„íš¨ìœ¨ì  | íš¨ìœ¨ì  |
| Python íŠ¹í™” | X | O |

---

## í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… |
|:---:|:---|
| **WSGI** | ì›¹ ì„œë²„ â†” Python ì•± í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ |
| **ì¸í„°í˜ì´ìŠ¤** | `application(environ, start_response)` |
| **environ** | ìš”ì²­ ì •ë³´ ë”•ì…”ë„ˆë¦¬ |
| **start_response** | ì‘ë‹µ í—¤ë” ì„¤ì • ì½œë°± |
| **ë°˜í™˜ê°’** | iterable (ì‘ë‹µ ë³¸ë¬¸) |
| **ë™ì‹œì„±** | ë™ê¸°, ë©€í‹° í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ |
| **í•œê³„** | ë¹„ë™ê¸° ë¶ˆê°€, WebSocket ë¶ˆê°€ |